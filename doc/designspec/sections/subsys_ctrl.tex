\documentclass[designspec/spec.tex]{subfiles}

\begin{document}

\section{Styrmodul}
Styrmodulen är en modul som har i uppgift att ta emot styrsignaler ifrån
kommunikationsmodulen och skicka dessa till bilens drivmotor och svängmotor.

\subsection{Funktion}
Styrmodulens syfte är att hantera den direkta kontrollen av styrreglagen för
taxins motorer. Styrmodulen ska kontrollera både drivmotorn och svängmotorn
utifrån kommandon som ges av kommunikationsmodulen.

\subsection{Hårdvaruimplementation}

\subsubsection{Kopplingsschema}
TODO

\subsubsection{Budget}
Utöver motorn och servon som redan sitter monterade på chassit behöver
styrmodulen följande komponenter:

\begin{itemize}
	\item \textbf{ATMega16} Modulens microprocessor. 
    \item \textbf{JTAG ICE mkII} Debugger för programmering och felsökning med
    microprocessorn. 
    \item \textbf{LCD JM162A} LCD-display för att visa parametrar under körning
    i felsökningssyfte.
\end{itemize}

\subsubsection{Kontroll}
Av portarna på microprocessorn används 7/8 av portA, 1/8 av portB, 6/8 av portC
och 5/8 av portD. D.v.s. portarna räcker till.
Se kopplingsschemat för att mer detaljerat se använda portar.

\subsubsection{Bedömning}

\subsection{Mjukvaruimplementation}
Styrmodulens program kommer bestå av en main loop som reglerar bilens hastighet
efter ett felvärde. Ett avbrott som aktiveras när kommunikationsmodulen vill
kommunicera kommer att ta emot nya felvärden med jämna mellanrum.

\subsubsection{Flödesschema}

\subsubsection{Avbrott}

\begin{itemize}
	\item \textbf{TWI\_Interrupt} Avbrottet sker när TWI-bussen adresserar
	styrmodulen. I avbrottet måste statusregistret TWSR maskas för att kunna
	avgöra vilken funktion som ska utföras. T.ex. skicka/ta emot data e.t.c. 

	\item \textbf{Output\_Compare\_Interrupt} Avbrottet sker när en PWM puls
	ska skickas ut till servon eller motorn. Avbrottet sker varje gång
	motsvarande timer-register har nått sitt maximum och startar om från noll.
\end{itemize}

\subsubsection{Huvud-loop}
I huvudloopen kommer värdena från kommunikationsmodulen göras om till
motsvarande tidsintervall i PWM. Beroende på hur snabbt det går så kommer
huvudloopen vänta på avbrott.

\subsection{Komponenter}
\paragraph{ATMega16} bla bla TODO
\paragraph{Drivmotor} bla bla TODO
\paragraph{Servo} bla bla TODO
\paragraph{LCD JM162A} bla bla TODO

\end{document}
