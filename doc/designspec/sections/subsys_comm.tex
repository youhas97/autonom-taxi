\documentclass[designspec/spec.tex]{subfiles}

\begin{document}

\section{Kommunikationsmodul}
Kommunikationsmodulen ska agera som taxins hjärna. Den styr bilen under autonom
körning och kommunicerar med fjärrklienten. Sensorvärden från sensormodulen
tolkas av kommunikationsmodulen som därefter skickar felvärden till
styrmodulen.

\subsection{Funktion}
Kommunikationsmodulen har tre huvudsakliga uppgifter; bildbehandling,
kommunicera med fjärrklienten och kontrollera taxin autonomt.

\paragraph{Bildbehandling} skall utföras av kommunikationsmodulen för att
avgöra bilens position i vägfilen och upptäcka stopplinjer. Med hjälp av
kamerans bilder på vägen skapas ett felvärde som kan användas för att justera
taxins riktning.

\paragraph{Kommunikation med fjärrklienten} sköts av kommunikationsmodulen för
att skicka sensorvärden och annan relevant information. Modulen skall även ta
emot ett uppdrag som har skapats utifrån en karta och destination som
användaren har matat in via fjärrklienten.

\paragraph{Autonomitet} utförs av kommunikationsmodulen för att utföra
uppdraget. Kommunikationsmodulen hämtar sensordata från sensormodulen och
bildbehandlar kamerabilderna för att utföra beslut i realtid. Besluten kommer
därefter att översättas till felvärden som skickas till styrmodulen.

\subsection{Hårdvaruimplementation} 
Kommunikationsmodulen kommer att implementeras med hjälp av en Raspberry Pi 3,
där en bluetooth och wifikomponent redan finns integrerat. Kameran kommer att
kopplas direkt till kameraporten som finns på Raspberry Pi-kortet.
GPIO-pinnarna  kommer att användas för att ansluta till övriga moduler.
Eftersom SPI-protokollet kommer att användas, kommer fem GPIO-portar att
användas för de fem signalerna som protokollet kräver.Det kommer att finnas två
nivåskiftare som skiftar spänningen på de fem signalerna som kommer från
Raspberryn. Nivåskiftaren kommer att försörjas med en spänning från en 3.3V
pin, samt en 5V pin för att kunna skifta
spänningen från 3.3V som är den spänningen Raspberry Pi 3 stödjer, till 5V som
är den spänningen sensormodulen och styrmodulen använder.
% TODO hänvisa till kretsschema i bilaga

Kommunikationen med fjärrklienten kommer att ske med en inbyggd Wi-Fi eller
Bluetooth-modul på Raspberry Pi-enheten. Anslutningen kommer att ske via wifi
och skapas med en dator med operativsystemet Raspbian och program som
exempelvis wpa\_supplicant kan användas för att sätta upp anslutningen.

\subsubsection{Budget}
\begin{itemize}
    \item \textbf{Raspberry Pi 3} Modulens dator med inbyggt trådlöst
    nätverkskort.
    \item \textbf{Raspberry Pi Camera V2 Video Module} Kamera till Raspberry
    Pi.
    \item \textbf{TXB0104 Level Shifter} Nivåskiftare för att kunna kommunicera
    med mikrokontrollerna.
\end{itemize}

\subsection{Mjukvaruimplementation}
Kommunikationsmodulen ska bestå av flera trådar TODO

TODO komm mjukvara
%- skrivs i c eller möjligtvis c++
%- eventuell trådsuppdelning
%    - server för länk och uppdragshantering
%    - hämta från sensor och skicka till styr
%    - bildhantering för att generera felvärde

\end{document}
