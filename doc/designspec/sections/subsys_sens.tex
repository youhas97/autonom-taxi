\documentclass[designspec/spec.tex]{subfiles}

\begin{document}

\section{Sensormodul}
Sensormodulen ska agera som taxins känselspröt. Den kommer att mäta av olika
värden från de olika sensorerna som finns för att sedan skicka mätdata till
kommunikationsmodulen.

\subsection{Funktion}
Sensormodulen ska hämta eventuellt filtrerade värden från sensorerna, omvandla
till linjära enheter och skicka vidare de till kommunikationsmodulen.

\paragraph{Sensorer}
Taxin kommer att ha en optisk avståndsmätare som pekar rakt fram för att
upptäcka hinder framför bilen samt en optisk avståndsmätare på sidan för att
detektera hinder höger om bilen vid omkörning.

\paragraph{Filtrering} Eftersom sensorerna kan bli påverkade av eventuella
störningar kommer det eventuellt att finnas brusfilter som filtrerar bort dessa
störningar för att skapa så noggranna sensorvärden som möjligt.

\subsection{Hårdvaruimplementation} Sensormodulen består av en ATMega1284
mikrokontroller, JTAG, Kristalloscillator, strömbrytare och fyra sensorer; en
avståndsmätare på framsidan, en avståndsmätare på höger sida samt två
halleffektsensorer placerade på två av hjulen. Kontrollern är även kopplad till
en LCD-display för att kunna visa värden för felsökning.

På LCD-DISPLAY har följande två pinnar valts till att ha ett konstant värde:
R/W och E. Eftersom inget krav finns på att kunna släcka LCD alternativt läsa
från displayen så är enable och write-signalen alltid igång.

Halleffektsensorerna kommer skicka en avbrottssignal varje gång hjulet har
snurrat ett varv. Avbrottsrutinen ser till att räkna upp distans körd.

Avståndsmätarna skickar en spänning direkt till mikrokontrollens AD-omvandlare.
Spänningens värde motsvarar ett avstånd. Utspänningen kan eventuellt behöva
filtreras från brus.

Önskad klockfrekvens från oscillatorn är 24Mhz, någon division av den
fundamentala klockan är inte planerat.

Ett kretsschema över modulen finns i bilaga \ref{cdiag:sens}.

\subsubsection{Budget}
Nedan är produkter som ej medföljer baschassit och behöver beställas.
\begin{itemize}
	\item \textbf{\modMicrocontroller} Modulens microprocessor. 
    \item \textbf{\modDistf} Avståndsmätare för hinder framför bilen.
    \item \textbf{\modDists} Avståndsmätare för hinder höger om bilen.
    \item \textbf{\modLcd} LCD-display för att visa parametrar under körning
    i felsökningssyfte.
    \item \textbf{IQEXO3} Kristalloscillator på 20Mhz, skall använda som systemklocka till AVR.
    \item \textbf{Tryckknapp} Knapp används till RESET.
    \item \textbf{AVR-JTAG} JTAG för flashning av program till mikrokontrollern.
\end{itemize}

\subsubsection{Kontroll och bedömning}
Nedan är följande pinnar som används på mikrokontrollern.
\begin{itemize}
   \item \textbf{PA0 \& PA2} Vardera port får insignal från en avståndsmätare.
   \item \textbf{PB2-PB3} Vardera port får en avbrottsignal från en odometer.
   \item \textbf{PB4-PB7} SPI-buss
   \item \textbf{PC2-PC5} AVR-JTAG
   \item \textbf{PC7} Reset signal till LCD-Display
   \item \textbf{PD0-PD7} Databuss till LCD-display
   \item \textbf{RESET(9)} Knapp till reset för MCU
   \item \textbf{XTAL1} Input från Kristalloscillatorn
\end{itemize}
Mikrokontrollen behöver endast kommunicera med kommunikationsmodulen via SPI
samt ta emot värden från sensorerna och göra enkla beräkningar vid omvandling.
Mikrokontrollen bör inte ha något problem att utföra dessa uppgifter.

\subsection{Mjukvaruimplementation} 
Sensormodulen ska bestå av en tom while loop och ett avbrott som aktiveras när
kommunikationsmodulen efterfrågar värden. Sensormodulen skickar då de senaste
sensorvärdena och samplar därefter nästa grupp av värden.
% TODO utveckla impl, lär vara liknande som i ctrl så kanske kan referera sen

\end{document}
